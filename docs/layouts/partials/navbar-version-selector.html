{{/* set sane defaults */}}
{{ $.Scratch.Set "docLabel" "Version " }}
{{ $.Scratch.Set "activeVersion" .Site.Params.version }}
{{ $curPage := .Page.Section }}
{{/* find version matching the current page */}}
{{ range .Site.Params.versions }}
  {{ if eq $curPage .dirpath }}
    {{ $.Scratch.Add "docLabel" (printf "(%s)" .version) }}
    {{ $.Scratch.Set "activeVersion" .version }}
  {{ end }}
{{ end }}

{{ if not (eq .Params.versionPicker false) }}
<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    {{ printf "%s" ($.Scratch.Get "docLabel") }}
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
    {{/* Show dev version first if it exists */}}
    {{ range .Site.Params.versions }}
        {{ if eq .version "dev" }}
        <a
            class="dropdown-item{{ if eq ( $.Scratch.Get "activeVersion" ) ( printf "%s" .version ) }} active{{ end }}"
            href="{{ cond (gt (len (findRE "^http(s)?://" .url)) 0) .url (relURL .url) }}"
        >
            {{ .version }}
        </a>
        {{ end }}
    {{ end }}
    {{/* Show all other versions */}}
    {{ range .Site.Params.versions }}
        {{ if ne .version "dev" }}
        <a
            class="dropdown-item{{ if eq ( $.Scratch.Get "activeVersion" ) ( printf "%s" .version ) }} active{{ end }}"
            href="{{ cond (gt (len (findRE "^http(s)?://" .url)) 0) .url (relURL .url) }}"
        >
            {{ .version }}
        </a>
        {{ end }}
    {{ end }}
    <div class="dropdown-divider"></div>
</div>
{{ end }}
